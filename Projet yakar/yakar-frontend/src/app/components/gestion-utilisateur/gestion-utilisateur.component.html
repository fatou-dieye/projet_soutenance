<!--gestion utilisateur html-->
<div class="gestion-utilisateur">
  <!-- En-t√™te avec titre et bouton d'ajout -->
  <div class="header">
    <h1>Liste des utilisateurs</h1>
    <button class="add-button" (click)="openAddModal()">
      <span>+</span>Ajouter un utilisateur
    </button>
  </div>

  <!-- Message de succ√®s -->
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <!-- Status de role et recherche -->
  <div class="stats-search">
    <div class="stats">
      <p>Nombre Administrateurs: {{ adminCount }}</p>
      <p>Nombre Utilisateur: {{ userCount }}</p>
    </div>
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchText" 
        (input)="onSearch($event)" 
        placeholder="Rechercher..." 
      />
      <span class="search-icon">üîç</span>
    </div>
  </div>

  <!-- Tableau des utilisateurs -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Nom et Pr√©nom</th>
          <th>Email</th>
          <th>Matricule</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of paginatedUtilisateurs">
          <td>{{ user.nom }} {{ user.prenom }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.matricule }}</td>
          <td>
            <span [class]="user.role === 'administrateur' ? 'badge admin' : 'badge user'">
              {{ user.role }}
            </span>
          </td>
          <td class="actions">
            <button 
              class="action-btn role-toggle" 
              *ngIf="user._id" 
              (click)="toggleRole(user)" 
              [title]="'Changer le r√¥le en ' + (user.role === 'administrateur' ? 'utilisateur' : 'administrateur')"
            >
              <img src="/double-fleche.png" alt="Ic√¥ne double fl√®che" />
            </button>
            <button class="action-btn edit" *ngIf="user._id" (click)="editUser(user._id)">
              üñç
            </button>
            <button class="action-btn delete" *ngIf="user._id" (click)="deleteUser(user._id)">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Pagination -->
  <div class="pagination">
    <button [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
      ‚Üê Pr√©c
    </button>
    
    <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
      <button 
        [class.active]="currentPage === i + 1" 
        (click)="changePage(i + 1)"
      >
        {{ i + 1 }}
      </button>
    </ng-container>
    
    <button [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
      Suiv ‚Üí
    </button>
  </div>
</div>

<!-- Modals -->
<!-- Modal de confirmation changement de r√¥le -->
<div class="modal-background" *ngIf="showConfirmationModal">
  <div class="modal-container">
    <h2>Confirmer le changement de r√¥le</h2>
    <p>√ätes-vous s√ªr de vouloir changer le r√¥le de {{ userToChangeRole?.nom }} {{ userToChangeRole?.prenom }} ?</p>
    <div class="modal-actions">
      <button class="btn btn-blue" (click)="confirmRoleChange()">Modifier le r√¥le</button>
      <button class="btn btn-red" (click)="closeConfirmationModal()">Annuler</button>
    </div>
  </div>
</div>

<!-- Modal de confirmation suppression -->
<div class="modal-background" *ngIf="showDeleteConfirmModal">
  <div class="modal-container">
    <h2>Confirmer la suppression</h2>
    <p>√ätes-vous s√ªr de vouloir supprimer {{ userToChangeRole?.nom }} {{ userToChangeRole?.prenom }} ?</p>
    <div class="modal-actions">
      <button class="btn btn-red" (click)="confirmDeleteUser()">Supprimer</button>
      <button class="btn btn-blue" (click)="closeDeleteConfirmModal()">Annuler</button>
    </div>
  </div>
</div>

<!-- Modal ajout utilisateur-->
<app-modal-utilisateur 
  *ngIf="showAddModal" 
  (close)="closeAddModal()" 
  (success)="handleSuccess($event)">
</app-modal-utilisateur>

<!-- Modal modifier utilisateur-->
<app-modal-modification 
  *ngIf="showEditModal" 
  [userId]="selectedUserId!"
  (close)="closeEditModal()">
</app-modal-modification>